%%{init: {'theme': 'base', 'themeVariables': { 'fontFamily': 'arial', 'fontSize': '16px', 'primaryColor': '#fff', 'edgeLabelBackground': '#fff', 'clusterBkg': '#f9f9f9', 'clusterBorder': '#666' }}}%%
graph TD
    %% æ ·å¼å®šä¹‰
    classDef userNode fill:#FFAB91,stroke:#BF360C,stroke-width:2px,color:white,font-weight:bold;
    classDef clientEnv fill:#E1F5FE,stroke:#0277BD,stroke-width:2px,stroke-dasharray: 5 5;
    classDef serverEnv fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,stroke-dasharray: 5 5;
    classDef database fill:#E0F2F1,stroke:#00695C,stroke-width:2px,rx:5,ry:5;
    classDef component fill:#ffffff,stroke:#455A64,stroke-width:1px,rx:5,ry:5;
    classDef highlight fill:#FFF9C4,stroke:#FBC02D,stroke-width:2px,rx:5,ry:5;

    %% ç”¨æˆ·
    User((User / ç”¨æˆ·)):::userNode

    %% å®¢æˆ·ç«¯å±‚
    subgraph Clients ["ğŸ”Œ å®¢æˆ·ç«¯å±‚ (Clients)"]
        direction TB
        
        subgraph Chrome ["Chrome æµè§ˆå™¨"]
            GeminiWeb["ğŸ–¥ï¸ Gemini ç½‘é¡µç‰ˆ"]:::component
            Extension["ğŸ§© Chrome æ’ä»¶<br/>(Content Script)"]:::highlight
        end
        
        subgraph Agent ["AI Agent ç¯å¢ƒ"]
            MCPServer["ğŸ¤– MCP Server<br/>(mcp_server.py)"]:::highlight
            Claude["Claude / Cursor"]:::component
        end
    end

    %% æœåŠ¡ç«¯å±‚
    subgraph Server ["âš™ï¸ æ ¸å¿ƒæœåŠ¡å±‚ (Backend)"]
        direction TB
        
        FastAPI["ğŸš€ FastAPI Server<br/>(main.py)"]:::highlight
        ChromaDB[("ğŸ—„ï¸ ChromaDB<br/>(Vector Store)")]:::database
    end

    %% å…³ç³»è¿çº¿
    
    %% ç”¨æˆ·äº¤äº’
    User ==>|"èŠå¤©"| GeminiWeb
    User ==>|"å·¥å…·è°ƒç”¨"| Claude

    %% æ’ä»¶äº¤äº’
    GeminiWeb -.->|"DOM ç›‘å¬/æ³¨å…¥"| Extension
    Extension <==>|"HTTP POST<br/>(search/add)"| FastAPI

    %% MCP äº¤äº’
    Claude <==>|"Stdio / SSE"| MCPServer
    MCPServer <==>|"HTTP POST<br/>(search/add/delete)"| FastAPI

    %% æ•°æ®äº¤äº’
    FastAPI <==>|"Embedding & Storage"| ChromaDB

    %% æ ·å¼åº”ç”¨
    class Chrome,Agent clientEnv
    class Server serverEnv