%%{init: {'theme': 'base', 'themeVariables': { 'fontFamily': 'arial', 'fontSize': '16px', 'primaryColor': '#fff', 'edgeLabelBackground': '#fff', 'clusterBkg': '#f9f9f9', 'clusterBorder': '#666' }}}%%
graph TD
    %% æ ·å¼å®šä¹‰
    classDef userNode fill:#FFAB91,stroke:#BF360C,stroke-width:2px,color:white,font-weight:bold;
    classDef browserEnv fill:#E1F5FE,stroke:#0277BD,stroke-width:2px,stroke-dasharray: 5 5;
    classDef localEnv fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,stroke-dasharray: 5 5;
    classDef cloudEnv fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,stroke-dasharray: 5 5;
    
    classDef component fill:#ffffff,stroke:#455A64,stroke-width:1px,rx:5,ry:5,shadow:true;
    classDef highlight fill:#FFF9C4,stroke:#FBC02D,stroke-width:2px,rx:5,ry:5;
    classDef database fill:#E0F2F1,stroke:#00695C,stroke-width:2px,rx:5,ry:5;

    %% ç”¨æˆ·
    User((User / ç”¨æˆ·)):::userNode

    %% æµè§ˆå™¨ç¯å¢ƒ
    subgraph ChromeBrowser ["â˜ï¸ Chrome æµè§ˆå™¨ç¯å¢ƒ"]
        direction TB
        GeminiWeb["ğŸ–¥ï¸ Gemini ç½‘é¡µç‰ˆ UI"]:::component
        Extension["ğŸ§© Chrome æ’ä»¶ (å‰ç«¯)"]:::highlight
        
        %% å†…éƒ¨è¿çº¿
        Extension -.- |"1. ç›‘å¬/æŠ“å–"| GeminiWeb
        Extension -.- |"2. æ³¨å…¥è®°å¿†"| GeminiWeb
    end

    %% æœ¬åœ°ç¯å¢ƒ
    subgraph LocalEnvironment ["ğŸ’» ä½ çš„ç”µè„‘ (Localhost)"]
        direction TB
        
        %% ä¸­è½¬æœåŠ¡
        SyncServer["âš™ï¸ æœ¬åœ° Python Server<br/>(FastAPI / Flask)"]:::highlight
        
        %% CLI
        GeminiCLI["âŒ¨ï¸ Gemini CLI å·¥å…·"]:::component
        
        %% å­˜å‚¨
        MemoryDB[("ğŸ—„ï¸ æœ¬åœ°è®°å¿†åº“<br/>JSON / SQLite")]:::database
        
        %% å†…éƒ¨è¿çº¿
        SyncServer <-->|"è¯»/å†™"| MemoryDB
        GeminiCLI <-->|"API è¯·æ±‚"| SyncServer
    end

    %% è¿œç¨‹æœåŠ¡
    subgraph GoogleCloud ["ğŸŒ Google Cloud"]
        RealGemini["ğŸ§  Google Gemini API"]:::component
    end

    %% å¤–éƒ¨äº¤äº’
    User ==>|"æ‰“å­—èŠå¤©"| GeminiWeb
    User ==>|"å‘½ä»¤è¡ŒæŒ‡ä»¤"| GeminiCLI
    
    GeminiWeb <-->|"HTTPS"| RealGemini
    GeminiCLI <-->|"HTTPS"| RealGemini

    %% æ ¸å¿ƒè·¨åŸŸé“¾è·¯
    Extension <==>|"HTTP (localhost:8000)"| SyncServer

    %% åº”ç”¨æ ·å¼åˆ°å­å›¾ (è™½ç„¶Mermaidå¯¹å­å›¾æ ·å¼æ”¯æŒæœ‰é™ï¼Œè¿™é‡Œå°è¯•ä¿æŒé»˜è®¤æˆ–é€šè¿‡initæ§åˆ¶)
    %% Note: Subgraph styling is handled by theme variables mainly in this config
